---
title: "Assignment2"
author: "Vienna Saccomanno"
date: "2/10/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages}

library(tidyverse)
library(scales)
library(stargazer)

```

##Task 1. Cetaceans in Captivity

```{r get_data}
cetaceans<- read_csv("captive_cetacean.csv")
```

```{r wrangle}

cod<- cetaceans %>%
  filter(acquisition %in% c("Rescue", "Capture", "Born")) %>% 
  mutate(acquisition = recode_factor(acquisition,
   'Rescue' = 'Rescued', 'Born' = 'Born in Captivity', 'Capture' = 'Captured')
  ) 
 
cod$originDate = as.Date(as.character(cod$originDate), format = "%m/%d/%y", "%y")
View(cod)

cod_viz<- cod %>% 
  ggplot(aes(x=originDate, fill=as.factor(acquisition)))+
                   geom_histogram(alpha=0.7, bins = 90, color= "black", linetype = "solid") +
  scale_fill_manual(name= "Acquisition\nType", values = c("Captured" = "red",
                              "Born in Captivity"="yellow",
                              "Rescued" = "blue"))+
  scale_x_date(breaks = date_breaks("10 years"), 
               labels = date_format("%Y")) + 
  scale_y_discrete(limits=seq(0,170,20))+
  labs(x= '',
       y= 'Number of Cetaceans')+
  theme_classic()
 
cod_viz

```


##Task 2. Parameter Estimation - Wild Fish Catch
```{r get_data2}
#Read-in catch data
catch<- read_csv("fish_catch.csv")

#Setting "Year" to a sequence of numbers
catch_seq<- catch %>% 
  mutate("seq"= seq(from=0, to=62)) 
```

```{r exploratory_graph}

#Making an exploratory graph to estimate the structure of the data
ggplot(catch_seq, aes(x=seq, y=Wild_Catch))+
  geom_point()+
  theme(axis.text.x=element_text(angle=90, hjust=1))

#Estimate B
Bestimate<- (90 - 15)/15

```
####Exploratory graph interpretation
- The wild catch data from 1950-2012 look non-linear and fairly logistic.
- Logistic growth equation: $$N_t = \frac{A}{1+Be^{-rt}}$$
- Initial estimates: 
    -Estimate for K/A: ~ 90 million tons
    -Estimate for N0: ~ 15 million tons
    -Estimate for B: ~ 5
          -BEstimate:(90 - 15)/15 # BEstimate = 5 million tons
    -Estimate for r: ~0.05749


```{r equation_estimates}
#Looking at the graph, 1950-1970 (i.e. 1-20) was the exponential catch phase. Slope of natural log (y=e^rt -> ln(y) = rt) = r. 

#Estimate r (the catch rate). Isolate the first 20 points
r_est <- catch_seq %>%
  filter(seq<21) 

#Make sure the log is linear
ggplot(r_est, aes(x=seq, y=log(Wild_Catch)))+
  geom_point()

#Estimate r
lm(log(Wild_Catch) ~seq, data=r_est)
#r initial = 0.05749
```


```{r nls}
#Model fitting
catch_fit <- nls(Wild_Catch ~ A/(1+B*exp(-r*seq)), 
                start = list(A = 90, B = 5, r = 0.05749), 
                data = catch_seq, trace = TRUE) 

#Least squares are converging at 1365.1; A =100.28 million tons, B= 4.32 million tons, r=0.06989 

#Table summary of results
stargazer(catch_fit, title = "Results", align=TRUE)
```

####Nonlinear least squares parameter outcome
- Least squares are converging at 1365.1
- A=100.28 million tons 
- B=4.32 million tons 
- r=0.06989 

```{r predicting}

A <- coef(catch_fit)[1]
B <- coef(catch_fit)[2]
r <- coef(catch_fit)[3]

#Create a new sequence of time values (time_seq)
time_seq <- seq(0,100, length = 100)

#Using the parameters (A, B, and r) and the time sequence, predict the catch for the logistic growth model
catch_pred <- A/(1+B*exp(-r*time_seq))

#Binding together the time sequence data and the predictions data into a new data frame
pred_df <- data.frame(time_seq, catch_pred)

```

```{r graphing_pred}

ggplot(catch_seq, aes(x = seq, y = Wild_Catch)) + 
  geom_point(colour = "purple", size = 3) + 
  theme_bw() +
  geom_line(data = pred_df, aes(x = time_seq, y = catch_pred), colour = "orange", size = 1) + 
  xlab("Year") +
  ylab("Catch (million tons)") +
  ggtitle("Wild Catch 1950-2012 and predicted catch through 2050")+
  theme_classic()

```

